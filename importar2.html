<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta Hosts - AgÃªncia Maravilha</title>
<link rel="icon" href="assets/logo.jpg">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
  background: linear-gradient(120deg, #0f172a, #1e293b);
  color: white;
  font-family: Arial, sans-serif;
  padding: 40px;
}
.container { max-width: 900px; margin:auto; }
.card {
  background:#1e293b;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
}
button {
  font-weight:bold;
  cursor:pointer;
  border:none;
  border-radius:6px;
  padding:10px 20px;
  margin-top:10px;
}
.btn-brand{
  background: linear-gradient(90deg, #2563eb, #3b82f6);
  border:none;
  color:#ffffff;
}
.btn-brand:hover{ filter:brightness(1.05); }
.status { margin-top:10px; font-weight:bold; transition: all 0.3s ease; }
table { width:100%; margin-top:20px; border-collapse: collapse; }
th, td { border:1px solid #334155; padding:8px; text-align:left; }
th { background:#1e293b; }
tr:nth-child(even){ background:#1f2937; }
</style>
</head>
<body>

<div class="container">
  <h2>Consulta de Hosts</h2>

  <div class="card">
    <h3>Pesquisar Host</h3>
    <div class="mb-3">
      <label>Digite Apelido ou Kwai ID</label>
      <input type="text" id="hostSearch" class="form-control" placeholder="Ex: Uembaixador">
    </div>
    <button class="btn btn-brand" id="btnFiltrar">Pesquisar</button>
    <div id="status" class="status"></div>
  </div>

  <div class="card">
    <h3>Resultados</h3>
    <table id="tabelaHosts">
      <thead>
        <tr>
          <th>Member ID</th>
          <th>Apelido</th>
          <th>Kwai ID</th>
          <th>Status</th>
          <th>Data de Entrada</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script type="module">
import { supabase, protectPage, logout } from "./supabase.js";

await protectPage();

const hostSearch = document.getElementById('hostSearch');
const btnFiltrar = document.getElementById('btnFiltrar');
const status = document.getElementById('status');
const tabelaBody = document.querySelector('#tabelaHosts tbody');

btnFiltrar.addEventListener('click', async () => {
  const filtro = hostSearch.value.trim();
  tabelaBody.innerHTML = '';
  status.innerText = '';

  if (!filtro) {
    status.innerText = 'Digite algo para pesquisar';
    return;
  }

  status.innerText = 'Carregando...';

  const { data, error } = await supabase
    .from('hosts')
    .select('member_Id,Apelido_de_streamer,kwaiId,Status_de_streamer,Data_de_entrada')
    .or(`Apelido_de_streamer.ilike.%${filtro}%,kwaiId.ilike.%${filtro}%`);

  if (error) {
    status.innerText = 'Erro: ' + error.message;
    return;
  }

  if (!data || data.length === 0) {
    status.innerText = 'Nenhum host encontrado';
    return;
  }

  data.forEach(h => {
    tabelaBody.innerHTML += `
      <tr>
        <td>${h.member_Id}</td>
        <td>${h.Apelido_de_streamer}</td>
        <td>${h.kwaiId}</td>
        <td>${h.Status_de_streamer}</td>
        <td>${h.Data_de_entrada}</td>
      </tr>
    `;
  });

  status.innerText = `Mostrando ${data.length} host(s)`;
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
