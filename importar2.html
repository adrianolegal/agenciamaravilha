<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta Hosts - Agência Maravilha</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #0f172a; color: white; font-family: Arial, sans-serif; padding: 40px; }
.container { max-width: 900px; margin: auto; }
.card { background:#1e293b; padding:20px; border-radius:12px; margin-bottom:20px; }
button { font-weight:bold; cursor:pointer; border:none; border-radius:6px; padding:10px 20px; margin-top:10px; }
.btn-brand{ background: linear-gradient(90deg, #2563eb, #3b82f6); color:#fff; }
.btn-brand:hover{ filter:brightness(1.05); }
.status { margin-top:10px; font-weight:bold; }
table { width:100%; margin-top:20px; border-collapse: collapse; }
th, td { border:1px solid #334155; padding:8px; text-align:left; }
th { background:#1e293b; }
tr:nth-child(even){ background:#1f2937; }
</style>
</head>
<body>

<div class="container">
  <h2>Consulta de Hosts</h2>

  <div class="card">
    <h3>Pesquisar Host</h3>
    <input type="text" id="hostSearch" class="form-control" placeholder="Digite Apelido ou Kwai ID">
    <button class="btn btn-brand" id="btnFiltrar">Pesquisar</button>
    <div id="status" class="status"></div>
  </div>

  <div class="card">
    <h3>Dados do Host</h3>
    <table>
      <thead>
        <tr>
          <th>Member ID</th>
          <th>Apelido de streamer</th>
          <th>Kwai ID</th>
          <th>Status de streamer</th>
          <th>Data de entrada</th>
          <th>Última transmissão ao vivo em</th>
          <th>Última publicação em</th>
          <th>Fluxo da transmissão ao vivo este mês</th>
          <th>Duração da transmissão ao vivo este mês</th>
          <th>Dias válidos de transmissão ao vivo este mês</th>
        </tr>
      </thead>
      <tbody id="tabelaDados"></tbody>
    </table>
  </div>
</div>

<script type="module">
import { supabase } from "./supabase.js";

const hostSearch = document.getElementById('hostSearch');
const btnFiltrar = document.getElementById('btnFiltrar');
const status = document.getElementById('status');
const tabelaDados = document.getElementById('tabelaDados');

btnFiltrar.addEventListener('click', async () => {
  tabelaDados.innerHTML = '';
  status.innerText = '';

  const filtro = hostSearch.value.trim();
  if (!filtro) { status.innerText = 'Digite algo para pesquisar'; return; }

  status.innerText = 'Carregando...';

  try {
    const { data, error } = await supabase
      .from('hosts')
      .select('member_Id,Apelido de streamer,kwaiId,Status de streamer,Data de entrada,Última transmissão ao vivo em,Última publicação em,Fluxo da transmissão ao vivo este mês,Duração da transmissão ao vivo este mês,Dias válidos de transmissão ao vivo este mês')
      .or(`"Apelido de streamer".ilike.%${filtro}%,kwaiId.ilike.%${filtro}%`);

    if (error) { status.innerText = 'Erro: ' + error.message; return; }
    if (!data || data.length === 0) { status.innerText = 'Nenhum host encontrado'; return; }

    data.forEach(d => {
      tabelaDados.innerHTML += `
        <tr>
          <td>${d.member_Id}</td>
          <td>${d["Apelido de streamer"]}</td>
          <td>${d.kwaiId}</td>
          <td>${d["Status de streamer"]}</td>
          <td>${d["Data de entrada"]}</td>
          <td>${d["Última transmissão ao vivo em"]}</td>
          <td>${d["Última publicação em"]}</td>
          <td>${d["Fluxo da transmissão ao vivo este mês"]}</td>
          <td>${d["Duração da transmissão ao vivo este mês"]}</td>
          <td>${d["Dias válidos de transmissão ao vivo este mês"]}</td>
        </tr>
      `;
    });

    status.innerText = `Mostrando ${data.length} host(s)`;
  } catch (err) {
    status.innerText = 'Erro inesperado: ' + err.message;
  }
});
</script>

</body>
</html>
