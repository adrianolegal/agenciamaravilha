<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta Hosts - Agência Maravilha</title>
<link rel="icon" href="assets/logo.jpg">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
  background: linear-gradient(120deg, #0f172a, #1e293b);
  color: white;
  font-family: Arial, sans-serif;
  padding: 40px;
}
.container { max-width: 900px; margin:auto; }
.card {
  background:#1e293b;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
}
button {
  font-weight:bold;
  cursor:pointer;
  border:none;
  border-radius:6px;
  padding:10px 20px;
  margin-top:10px;
}
.btn-brand{
  background: linear-gradient(90deg, #2563eb, #3b82f6);
  border:none;
  color:#ffffff;
}
.btn-brand:hover{ filter:brightness(1.05); }
.status { margin-top:10px; font-weight:bold; transition: all 0.3s ease; }
table { width:100%; margin-top:20px; border-collapse: collapse; }
th, td { border:1px solid #334155; padding:8px; text-align:left; }
th { background:#1e293b; }
tr:nth-child(even){ background:#1f2937; }
</style>
</head>
<body>

<div class="container">
  <h2>Consulta de Hosts</h2>

  <div class="card">
    <h3>Buscar Host</h3>
    <div class="mb-3">
      <input type="text" id="hostSearch" class="form-control" placeholder="Digite apelido ou Kwai ID">
    </div>
    <button class="btn btn-brand" id="btnBuscar">Buscar</button>
    <div id="status" class="status"></div>
  </div>

  <div class="card">
    <h3>Resultados</h3>
    <table id="tabelaHosts">
      <thead>
        <tr>
          <th>member_Id</th>
          <th>Apelido de streamer</th>
          <th>kwaiId</th>
          <th>Status de streamer</th>
          <th>Data de entrada</th>
          <th>Última transmissão ao vivo em</th>
          <th>Última publicação em</th>
          <th>Fluxo da transmissão ao vivo este mês</th>
          <th>Duração da transmissão ao vivo este mês</th>
          <th>Dias válidos de transmissão ao vivo este mês</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script type="module">
import { supabase, protectPage, logout } from "./supabase.js";

await protectPage(); // protege a página

const hostSearch = document.getElementById('hostSearch');
const btnBuscar = document.getElementById('btnBuscar');
const tabelaBody = document.querySelector('#tabelaHosts tbody');
const status = document.getElementById('status');

btnBuscar.addEventListener('click', async () => {
  tabelaBody.innerHTML = '';
  status.innerText = 'Carregando...';

  const filtro = hostSearch.value.trim();
  if (!filtro) { status.innerText = 'Digite apelido ou Kwai ID'; return; }

  // fetch no Supabase usando nomes corretos e aspas duplas
  const { data, error } = await supabase
    .from('hosts')
    .select(`
      member_Id,
      "Apelido de streamer",
      kwaiId,
      "Status de streamer",
      "Data de entrada",
      "Última transmissão ao vivo em",
      "Última publicação em",
      "Fluxo da transmissão ao vivo este mês",
      "Duração da transmissão ao vivo este mês",
      "Dias válidos de transmissão ao vivo este mês"
    `)
    .or(`"Apelido de streamer".ilike.%${filtro}%,kwaiId.ilike.%${filtro}%`);

  if (error) { status.innerText = 'Erro: ' + error.message; return; }
  if (!data || data.length === 0) { status.innerText = 'Nenhum host encontrado'; return; }

  data.forEach(h => {
    tabelaBody.innerHTML += `
      <tr>
        <td>${h.member_Id}</td>
        <td>${h["Apelido de streamer"]}</td>
        <td>${h.kwaiId}</td>
        <td>${h["Status de streamer"]}</td>
        <td>${h["Data de entrada"]}</td>
        <td>${h["Última transmissão ao vivo em"]}</td>
        <td>${h["Última publicação em"]}</td>
        <td>${h["Fluxo da transmissão ao vivo este mês"]}</td>
        <td>${h["Duração da transmissão ao vivo este mês"]}</td>
        <td>${h["Dias válidos de transmissão ao vivo este mês"]}</td>
      </tr>
    `;
  });

  status.innerText = `Mostrando ${data.length} host(s)`;
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
