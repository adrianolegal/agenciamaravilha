<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualizar Hosts - Agência Maravilha</title>
<link rel="icon" href="assets/logo.jpg">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/styles.css" rel="stylesheet">
<style>
body {
  background: linear-gradient(120deg, #0f172a, #1e293b);
  color: white;
  font-family: Arial, sans-serif;
  padding: 40px;
}
.container { max-width: 1000px; margin:auto; }
.card { background:#1e293b; padding:20px; border-radius:12px; margin-bottom:20px; }
button {
  font-weight:bold;
  cursor:pointer;
  border:none;
  border-radius:6px;
  padding:10px 20px;
  margin-top:10px;
}
.status { margin-top:10px; font-weight:bold; transition: all 0.3s ease; }
.fade { animation: fade 0.5s ease-in-out; }
@keyframes fade { from { opacity:0 } to { opacity:1 } }

/* BOTÕES */
.btn-brand{
  background: linear-gradient(90deg, var(--brand), var(--brand2));
  border:none;
  color:#ffffff;
}
.btn-brand:hover{ filter:brightness(1.05); }

input, select { background: #1e293b; color: #fff; border-radius: 6px; border: 1px solid #555; padding: 6px; }

table { width: 100%; margin-top: 20px; border-collapse: collapse; }
table, th, td { border: 1px solid #555; }
th, td { padding: 8px; text-align: left; }
th { background: #2563eb; color: #fff; }
tr:nth-child(even) { background: #1e293b; }
</style>
</head>

<body>

<div class="container">
  <h2>Visualizar Dados de Hosts</h2>

  <div class="card">
    <h3>Filtro</h3>
    <div class="row g-3">
      <div class="col-md-4">
        <label>Host</label>
        <select id="hostSelect" class="form-select"></select>
      </div>
      <div class="col-md-2">
        <label>Mês</label>
        <select id="mesInput" class="form-select">
          <option value="1">Janeiro</option>
          <option value="2">Fevereiro</option>
          <option value="3">Março</option>
          <option value="4">Abril</option>
          <option value="5">Maio</option>
          <option value="6">Junho</option>
          <option value="7">Julho</option>
          <option value="8">Agosto</option>
          <option value="9">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
      </div>
      <div class="col-md-2">
        <label>Ano</label>
        <input type="number" id="anoInput" class="form-control" value="2025">
      </div>
      <div class="col-md-2 align-self-end">
        <button class="btn btn-brand" id="btnFiltrar">Filtrar</button>
      </div>
    </div>
    <div id="statusFilter" class="status"></div>
  </div>

  <div class="card">
    <h3>Resultados</h3>
    <table id="resultsTable">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Apelido</th>
          <th>Member ID</th>
          <th>Duração Vídeo</th>
          <th>Duração Áudio</th>
          <th>Receita Vídeo</th>
          <th>Receita Áudio</th>
          <th>Dias Vídeo</th>
          <th>Mês</th>
          <th>Ano</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script type="module">
import { supabase, protectPage } from "./supabase.js";

await protectPage();

const hostSelect = document.getElementById("hostSelect");
const mesInput = document.getElementById("mesInput");
const anoInput = document.getElementById("anoInput");
const resultsTable = document.getElementById("resultsTable").querySelector("tbody");
const status = document.getElementById("statusFilter");

// Carrega lista de hosts
async function loadHosts() {
  const { data, error } = await supabase.from('hosts').select('member_Id, nome_agente, apelido_streamer');
  if (error) { status.innerText = "Erro ao carregar hosts"; return; }

  hostSelect.innerHTML = data.map(h => `<option value="${h.member_Id}">${h.nome_agente} (${h.apelido_streamer})</option>`).join('');
}

// Busca dados filtrados
async function filtrar() {
  const member_id = hostSelect.value;
  const mes = mesInput.value;
  const ano = anoInput.value;
  resultsTable.innerHTML = '';
  status.innerText = "Carregando...";

  const { data, error } = await supabase
    .from('host_reports')
    .select('*')
    .eq('member_id', member_id)
    .eq('mes', mes)
    .eq('ano', ano);

  if (error) { status.innerText = "Erro: " + error.message; return; }
  if (!data || data.length === 0) { status.innerText = "Nenhum dado encontrado"; return; }

  data.forEach(row => {
    resultsTable.innerHTML += `
      <tr>
        <td>${row.nome_agente || ''}</td>
        <td>${row.apelido_streamer || ''}</td>
        <td>${row.member_id || ''}</td>
        <td>${row.duracao_video || ''}</td>
        <td>${row.duracao_audio || ''}</td>
        <td>${row.receita_video || ''}</td>
        <td>${row.receita_audio || ''}</td>
        <td>${row.dias_video || ''}</td>
        <td>${row.mes || ''}</td>
        <td>${row.ano || ''}</td>
      </tr>
    `;
  });

  status.innerText = `Mostrando ${data.length} registro(s)`;
}

document.getElementById("btnFiltrar").addEventListener("click", filtrar);

loadHosts();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
