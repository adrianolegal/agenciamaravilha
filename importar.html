<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importar Hosts</title>
<!-- Estilos mantidos como no seu padrão -->
<style>
  body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin: 0; padding: 0; }
  .container { max-width: 800px; margin: 50px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
  h1 { color: #333; text-align: center; }
  input[type="file"] { display: block; margin: 20px auto; }
  button { display: block; margin: 20px auto; background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; }
  button:hover { background-color: #45a049; }
</style>
</head>
<body>

<div class="container">
  <h1>Importar Hosts</h1>
  <input type="file" id="fileInput" accept=".xlsx, .xls" />
  <button id="importButton">Importar Excel</button>
</div>

<!-- Supabase e XLSX -->
<script type="module">
import { supabase } from './supabase.js';
import * as XLSX from 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.mjs';

const fileInput = document.getElementById('fileInput');
const importButton = document.getElementById('importButton');

importButton.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if (!file) return alert('Selecione um arquivo Excel');

  try {
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data, { type: 'array' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    let json = XLSX.utils.sheet_to_json(sheet, { defval: null });

    json = json.map(row => ({
      'member_Id': parseInt(row['member_Id']),
      'Apelido de streamer': row['Apelido de streamer'],
      'kwaiId': row['kwaiId'],
      'Status de streamer': row['Status de streamer'],
      'Data de entrada': row['Data de entrada'],
      'Última transmissão ao vivo em': row['Última transmissão ao vivo em'],
      'Última publicação em': row['Última publicação em'],
      'Fluxo da transmissão ao vivo este  mês': row['Fluxo da transmissão ao vivo este  mês'],
      'Duração da transmissão ao vivo  este mês': row['Duração da transmissão ao vivo  este mês'],
      'Dias válidos de transmissão ao  vivo este mês': row['Dias válidos de transmissão ao  vivo este mês']
    }));

    const { data: inserted, error } = await supabase
      .from('hosts')
      .upsert(json, { onConflict: 'member_Id' });

    if (error) {
      console.error('Erro ao importar:', error);
      alert('Erro ao importar. Veja console.');
    } else {
      alert(`Importação concluída: ${inserted.length} registros.`);
    }
  } catch (err) {
    console.error('Erro ao ler o Excel:', err);
    alert('Erro ao ler o Excel. Verifique o arquivo.');
  }
});
</script>

</body>
</html>
