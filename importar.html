<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Importação</title>
<link rel="icon" type="image/png" href="assets/favicon.png">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Seu CSS padrão -->
<link href="assets/styles.css" rel="stylesheet">

<style>
/* Ajustes locais */
body { background: linear-gradient(120deg,#0f172a,#1e293b); color:white; font-family:Arial,sans-serif; padding:40px; }
.container { max-width:700px; margin:auto; }
.card { background:#1e293b; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 6px 20px rgba(0,0,0,0.3); }
.status { margin-top:10px; font-weight:bold; transition: all 0.3s ease; }
.fade { animation: fade 0.5s ease-in-out; }
@keyframes fade { from { opacity:0 } to { opacity:1 } }
/* Botões estilo Kwai */
.btn-brand { background:#2563eb; color:white; font-weight:bold; border-radius:999px; padding:12px 28px; font-size:1.25rem; box-shadow:0 6px 18px rgba(0,0,0,0.3); transition: all 0.3s ease; }
.btn-brand:hover { opacity:0.85; }
.btn-logout { background:#dc2626; color:white; font-weight:bold; padding:10px 20px; border-radius:6px; }
</style>
</head>
<body>

<div class="container">
  <h2 class="mb-4 text-center">Painel Admin</h2>

  <div class="card">
    <h4>Importar Hosts (Tabela 1)</h4>
    <input type="file" id="fileHosts" accept=".xlsx" class="form-control my-2">
    <button class="btn btn-brand" id="btnImportHosts">Importar Hosts</button>
    <div id="statusHosts" class="status"></div>
  </div>

  <div class="card">
    <h4>Importar Relatório Lives (Tabela 2)</h4>
    <input type="file" id="fileReports" accept=".xlsx" class="form-control my-2">
    <button class="btn btn-brand" id="btnImportReports">Importar Reports</button>
    <div id="statusReports" class="status"></div>
  </div>

  <div class="text-center mt-3">
    <button class="btn btn-logout" id="btnLogout">Logout</button>
  </div>
</div>

<!-- XLSX global -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script type="module">
import { supabase, protectPage, logout } from "./supabase.js";

protectPage();

document.getElementById("btnLogout").addEventListener("click", logout);


// Mostrar status
function showStatus(el, text, type) {
  el.className = `status fade ${type}`;
  el.innerText = text;
}

// Import Hosts
document.getElementById("btnImportHosts").addEventListener("click", async () => {
  const file = document.getElementById("fileHosts").files[0];
  const status = document.getElementById("statusHosts");
  if (!file) return showStatus(status, "Selecione um arquivo", "error");

  const reader = new FileReader();
  reader.onload = async (e) => {
    const workbook = XLSX.read(e.target.result, { type:'binary' });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet);

    const { error } = await supabase
      .from('hosts')
      .upsert(data, { onConflict: 'member_id' });

    if (error) showStatus(status, "Erro: " + error.message, "error");
    else showStatus(status, "Importado com sucesso ✓", "success");
  };
  reader.readAsBinaryString(file);
});

// Import Reports
document.getElementById("btnImportReports").addEventListener("click", async () => {
  const file = document.getElementById("fileReports").files[0];
  const status = document.getElementById("statusReports");
  if (!file) return showStatus(status, "Selecione um arquivo", "error");

  const reader = new FileReader();
  reader.onload = async (e) => {
    const workbook = XLSX.read(e.target.result, { type:'binary' });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet);

    const { error } = await supabase
      .from('host_reports')
      .insert(data);

    if (error) showStatus(status, "Erro: " + error.message, "error");
    else showStatus(status, "Importado com sucesso ✓", "success");
  };
  reader.readAsBinaryString(file);
});

// Logout
document.getElementById("btnLogout").addEventListener("click", logout);
</script>

</body>
</html>
