<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importar Hosts</title>
<!-- Mantendo cores e estilos padrão -->
<style>
body { font-family: Arial, sans-serif; background-color: #f5f5f5; color: #333; }
button { background-color: #007bff; color: #fff; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
button:hover { background-color: #0056b3; }
#mensagem { margin-top: 10px; color: red; font-weight: bold; }
</style>
<!-- Corrigindo link do XLSX -->
<script type="module">
import * as XLSX from 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.esm.min.mjs';
window.XLSX = XLSX;
</script>
</head>
<body>
<h2>Importar Hosts</h2>
<input type="file" id="arquivoExcel" accept=".xlsx,.xls">
<button id="importarBtn">Importar para Supabase</button>
<div id="mensagem"></div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabaseUrl = 'https://qgsfmiywdohybqlnxhdw.supabase.co';
const supabaseKey = 'COLOQUE_AQUI_SUA_CHAVE_ANON';
const supabase = createClient(supabaseUrl, supabaseKey);

const importarBtn = document.getElementById('importarBtn');
const arquivoInput = document.getElementById('arquivoExcel');
const mensagem = document.getElementById('mensagem');

importarBtn.addEventListener('click', async () => {
    const file = arquivoInput.files[0];
    if (!file) { mensagem.textContent = 'Selecione um arquivo primeiro.'; return; }

    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const json = XLSX.utils.sheet_to_json(sheet, { raw: false });

    try {
        const { error } = await supabase.from('hosts').upsert(json, {
            onConflict: ['member_Id'],
            returning: 'minimal',
        });
        if (error) { throw error; }
        mensagem.style.color = 'green';
        mensagem.textContent = 'Importação concluída com sucesso!';
    } catch (err) {
        mensagem.style.color = 'red';
        mensagem.textContent = 'Erro: ' + err.message;
    }
});
</script>
</body>
</html>
